<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Architecture - Market Screener Documentation</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
</head>
<body>
    <div class="documentation-container">
        <!-- Left Sidebar - Table of Contents -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>üöÄ Market Screener</h1>
                <p>Technical Documentation</p>
            </div>
            
            <nav class="toc">
                <div class="toc-section">
                    <a href="index.html" class="toc-main">üè† Home</a>
                </div>
                
                <div class="toc-section">
                    <a href="executive-summary.html" class="toc-main">üìã Executive Summary</a>
                    <a href="executive-summary.html#project-overview" class="toc-sub">Project Overview</a>
                    <a href="executive-summary.html#key-features" class="toc-sub">Key Features</a>
                </div>
                
                <div class="toc-section">
                    <a href="technology-stack.html" class="toc-main">üíª Technology Stack</a>
                    <a href="technology-stack.html#backend-tech" class="toc-sub">Backend Technologies</a>
                    <a href="technology-stack.html#frontend-tech" class="toc-sub">Frontend Technologies</a>
                    <a href="technology-stack.html#why-typescript" class="toc-sub">Why TypeScript</a>
                </div>
                
                <div class="toc-section">
                    <a href="architecture.html" class="toc-main active">üèóÔ∏è System Architecture</a>
                    <a href="#high-level-arch" class="toc-sub">High-Level Architecture</a>
                    <a href="#data-flow-arch" class="toc-sub">Data Flow Architecture</a>
                </div>
                
                <div class="toc-section">
                    <a href="backend-docs.html" class="toc-main">‚öôÔ∏è Backend Documentation</a>
                    <a href="backend-docs.html#root-files" class="toc-sub">Root Files</a>
                    <a href="backend-docs.html#configuration" class="toc-sub">Configuration</a>
                    <a href="backend-docs.html#controllers" class="toc-sub">Controllers</a>
                    <a href="backend-docs.html#middleware" class="toc-sub">Middleware</a>
                    <a href="backend-docs.html#models" class="toc-sub">Models</a>
                    <a href="backend-docs.html#routes" class="toc-sub">Routes</a>
                    <a href="backend-docs.html#services" class="toc-sub">Services</a>
                    <a href="backend-docs.html#alerts" class="toc-sub">Alerts</a>
                    <a href="backend-docs.html#jobs" class="toc-sub">Jobs</a>
                    <a href="backend-docs.html#utils" class="toc-sub">Utils</a>
                </div>
                
                <div class="toc-section">
                    <a href="frontend-docs.html" class="toc-main">üé® Frontend Documentation</a>
                    <a href="frontend-docs.html#pages" class="toc-sub">Pages</a>
                    <a href="frontend-docs.html#components" class="toc-sub">Components</a>
                    <a href="frontend-docs.html#context" class="toc-sub">Context</a>
                    <a href="frontend-docs.html#hooks" class="toc-sub">Hooks</a>
                </div>
                
                <div class="toc-section">
                    <a href="api-docs.html" class="toc-main">üîå API Documentation</a>
                    <a href="api-docs.html#auth-endpoints" class="toc-sub">Authentication</a>
                    <a href="api-docs.html#user-endpoints" class="toc-sub">User Management</a>
                    <a href="api-docs.html#alert-endpoints" class="toc-sub">Alert System</a>
                    <a href="api-docs.html#decision-endpoints" class="toc-sub">Decisions</a>
                </div>
                
                <div class="toc-section">
                    <a href="database-schema.html" class="toc-main">üóÑÔ∏è Database Schema</a>
                    <a href="database-schema.html#mongodb-collections" class="toc-sub">MongoDB Collections</a>
                    <a href="database-schema.html#redis-structures" class="toc-sub">Redis Structures</a>
                </div>
                
                <div class="toc-section">
                    <a href="configuration.html" class="toc-main">‚öôÔ∏è Configuration</a>
                    <a href="configuration.html#env-variables" class="toc-sub">Environment Variables</a>
                    <a href="configuration.html#config-categories" class="toc-sub">Config Categories</a>
                </div>
                
                <div class="toc-section">
                    <a href="deployment.html" class="toc-main">üöÄ Deployment Guide</a>
                    <a href="deployment.html#prerequisites" class="toc-sub">Prerequisites</a>
                    <a href="deployment.html#installation" class="toc-sub">Installation</a>
                    <a href="deployment.html#production" class="toc-sub">Production</a>
                </div>
                
                <div class="toc-section">
                    <a href="customization.html" class="toc-main">üîß Customization</a>
                    <a href="customization.html#new-alerts" class="toc-sub">New Alert Types</a>
                    <a href="customization.html#trading-strategies" class="toc-sub">Trading Strategies</a>
                    <a href="customization.html#ui-extension" class="toc-sub">UI Extension</a>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1>üèóÔ∏è System Architecture</h1>
                <p>Architectural Design & Data Flow</p>
            </div>
            
            <div class="content">
                <!-- System Architecture -->
                <div class="section" id="system-architecture">
                    <h2>üèóÔ∏è 3. System Architecture</h2>

                    <div class="overview-grid">
                        <div class="overview-card">
                            <h3>üéØ Layered Architecture</h3>
                            <p>Clean separation between presentation, business logic, and data layers</p>
                        </div>
                        
                        <div class="overview-card">
                            <h3>üîÑ Event-Driven Design</h3>
                            <p>Real-time processing with non-blocking I/O and event-driven patterns</p>
                        </div>
                        
                        <div class="overview-card">
                            <h3>üìä Microservices Ready</h3>
                            <p>Modular design that can be easily split into microservices</p>
                        </div>
                    </div>

                    <h3 id="high-level-arch">High-Level Architecture</h3>
                    <div class="diagram-container">
                        <h4>System Overview</h4>
                        <div class="mermaid">
                            graph TB
                                subgraph "Client Layer"
                                    A[Frontend React/Vite] 
                                    B[User's Browser]
                                end
                                
                                subgraph "Server Layer"
                                    C[Backend API Node.js/Express]
                                    D[SSE Real-time Connection]
                                end
                                
                                subgraph "Data Layer"
                                    E[MongoDB Database]
                                    F[Redis Cache]
                                end
                                
                                subgraph "External APIs"
                                    G[Twelve Data API]
                                    H[Alpaca Trading API]
                                end
                                
                                A <--> C
                                B <--> D
                                C <--> E
                                C <--> F
                                C <--> G
                                C <--> H
                                
                                style A fill:#667eea,stroke:#333,stroke-width:2px,color:#fff
                                style C fill:#2a5298,stroke:#333,stroke-width:2px,color:#fff
                                style E fill:#4caf50,stroke:#333,stroke-width:2px,color:#fff
                                style F fill:#ff5722,stroke:#333,stroke-width:2px,color:#fff
                        </div>
                    </div>

                    <h3 id="data-flow-arch">Data Flow Architecture</h3>
                    <div class="diagram-container">
                        <h4>Market Data Processing Flow</h4>
                        <div class="mermaid">
                            flowchart LR
                                A[Twelve Data API] --> B[Scanner Service]
                                B --> C[Data Processing]
                                C --> D[Alert Generation]
                                D --> E[Notifications]
                                
                                style A fill:#ffd54f,stroke:#333,stroke-width:2px
                                style B fill:#81c784,stroke:#333,stroke-width:2px
                                style C fill:#64b5f6,stroke:#333,stroke-width:2px
                                style D fill:#ffb74d,stroke:#333,stroke-width:2px
                                style E fill:#f06292,stroke:#333,stroke-width:2px
                        </div>
                        
                        <h4>User Interaction Flow</h4>
                        <div class="mermaid">
                            flowchart LR
                                A[Frontend] --> B[Backend API]
                                B --> C[Database]
                                C --> D[Redis Cache]
                                D --> E[Real-time Updates SSE]
                                
                                style A fill:#9c27b0,stroke:#333,stroke-width:2px,color:#fff
                                style B fill:#2196f3,stroke:#333,stroke-width:2px,color:#fff
                                style C fill:#4caf50,stroke:#333,stroke-width:2px,color:#fff
                                style D fill:#ff5722,stroke:#333,stroke-width:2px,color:#fff
                                style E fill:#795548,stroke:#333,stroke-width:2px,color:#fff
                        </div>
                        
                        <h4>Trading Execution Flow</h4>
                        <div class="mermaid">
                            flowchart LR
                                A[Decision Engine] --> B[Trading Service]
                                B --> C[Alpaca API]
                                C --> D[Position Management]
                                
                                style A fill:#673ab7,stroke:#333,stroke-width:2px,color:#fff
                                style B fill:#3f51b5,stroke:#333,stroke-width:2px,color:#fff
                                style C fill:#009688,stroke:#333,stroke-width:2px,color:#fff
                                style D fill:#ff9800,stroke:#333,stroke-width:2px,color:#fff
                        </div>
                    </div>

                    <h3>üè¢ Component Architecture</h3>
                    <div class="diagram-container">
                        <h4>Backend Component Structure</h4>
                        <div class="mermaid">
                            graph TB
                                subgraph "API Layer"
                                    A[Express Router]
                                    B[Controllers]
                                    C[Middleware]
                                end
                                
                                subgraph "Business Logic"
                                    D[Services]
                                    E[Decision Engine]
                                    F[Alert System]
                                end
                                
                                subgraph "Data Access"
                                    G[Models]
                                    H[Database]
                                    I[Cache]
                                end
                                
                                subgraph "External Services"
                                    J[Market Data API]
                                    K[Trading API]
                                    L[Notification Services]
                                end
                                
                                A --> B
                                B --> C
                                B --> D
                                D --> E
                                D --> F
                                D --> G
                                G --> H
                                G --> I
                                D --> J
                                D --> K
                                D --> L
                                
                                style A fill:#ff6b6b,stroke:#333,stroke-width:2px,color:#fff
                                style D fill:#4ecdc4,stroke:#333,stroke-width:2px,color:#fff
                                style E fill:#45b7d1,stroke:#333,stroke-width:2px,color:#fff
                                style F fill:#f9ca24,stroke:#333,stroke-width:2px,color:#fff
                        </div>
                    </div>

                    <h3>üìä Service Layer Architecture</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>üîç Scanner Service</h4>
                            <ul>
                                <li><strong>Purpose:</strong> Orchestrates market data monitoring</li>
                                <li><strong>Responsibilities:</strong> Data polling, interval management</li>
                                <li><strong>Integration:</strong> Twelve Data API, processing pipeline</li>
                                <li><strong>Scalability:</strong> Configurable polling intervals</li>
                            </ul>
                        </div>
                        
                        <div class="feature-card">
                            <h4>ü§ñ Decision Engine</h4>
                            <ul>
                                <li><strong>Purpose:</strong> Trading decision logic</li>
                                <li><strong>Responsibilities:</strong> Strategy evaluation, signal generation</li>
                                <li><strong>Integration:</strong> Trading service, position management</li>
                                <li><strong>Flexibility:</strong> Configurable decision rules</li>
                            </ul>
                        </div>
                        
                        <div class="feature-card">
                            <h4>üö® Alert System</h4>
                            <ul>
                                <li><strong>Purpose:</strong> Multi-channel notifications</li>
                                <li><strong>Responsibilities:</strong> Alert generation, delivery</li>
                                <li><strong>Channels:</strong> SSE, Push, Email</li>
                                <li><strong>Customization:</strong> User-defined thresholds</li>
                            </ul>
                        </div>
                        
                        <div class="feature-card">
                            <h4>üíº Trading Service</h4>
                            <ul>
                                <li><strong>Purpose:</strong> Trade execution and management</li>
                                <li><strong>Responsibilities:</strong> Order placement, position tracking</li>
                                <li><strong>Integration:</strong> Alpaca API, decision engine</li>
                                <li><strong>Risk Management:</strong> Position limits, stop losses</li>
                            </ul>
                        </div>
                    </div>

                    <h3>üîÑ Real-time Processing Architecture</h3>
                    <div class="api-endpoint">
                        <h4>Event-Driven Processing Pipeline</h4>
                        <div class="diagram-container">
                            <div class="mermaid">
                                flowchart TD
                                    A[Market Data Event] --> B[Data Validation]
                                    B --> C[Technical Analysis]
                                    C --> D[Pattern Detection]
                                    D --> E[Alert Evaluation]
                                    E --> F[Decision Processing]
                                    F --> G[Trade Execution]
                                    G --> H[Position Update]
                                    H --> I[Notification Dispatch]
                                    
                                    style A fill:#ffd54f,stroke:#333,stroke-width:2px
                                    style B fill:#81c784,stroke:#333,stroke-width:2px
                                    style C fill:#64b5f6,stroke:#333,stroke-width:2px
                                    style D fill:#ffb74d,stroke:#333,stroke-width:2px
                                    style E fill:#f06292,stroke:#333,stroke-width:2px
                                    style F fill:#9c27b0,stroke:#333,stroke-width:2px,color:#fff
                                    style G fill:#795548,stroke:#333,stroke-width:2px,color:#fff
                                    style H fill:#607d8b,stroke:#333,stroke-width:2px,color:#fff
                                    style I fill:#e91e63,stroke:#333,stroke-width:2px,color:#fff
                            </div>
                        </div>
                    </div>

                    <h3>üóÑÔ∏è Data Architecture</h3>
                    <div class="schema-box">
                        <h4>Data Storage Strategy</h4>
                        <div class="feature-grid">
                            <div class="feature-card">
                                <h4>üìä MongoDB (Primary Database)</h4>
                                <ul>
                                    <li><strong>User Data:</strong> Profiles, preferences, configurations</li>
                                    <li><strong>Historical Data:</strong> Alerts, decisions, trades</li>
                                    <li><strong>Event Logs:</strong> System events, audit trails</li>
                                    <li><strong>Relationships:</strong> User-alert, user-decision mappings</li>
                                </ul>
                            </div>
                            
                            <div class="feature-card">
                                <h4>‚ö° Redis (Cache Layer)</h4>
                                <ul>
                                    <li><strong>Real-time State:</strong> Current positions, active alerts</li>
                                    <li><strong>User Sessions:</strong> Authentication tokens, preferences</li>
                                    <li><strong>Performance Cache:</strong> Frequently accessed data</li>
                                    <li><strong>Queue Management:</strong> Processing queues, rate limiting</li>
                                </ul>
                            </div>
                            
                            <div class="feature-card">
                                <h4>üîÑ Data Synchronization</h4>
                                <ul>
                                    <li><strong>Write Strategy:</strong> Write-through to MongoDB</li>
                                    <li><strong>Read Strategy:</strong> Cache-first with fallback</li>
                                    <li><strong>Consistency:</strong> Eventual consistency model</li>
                                    <li><strong>Backup:</strong> Regular MongoDB snapshots</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <h3>üîê Security Architecture</h3>
                    <div class="highlight-box">
                        <h4>Security Layers</h4>
                        <div class="feature-grid">
                            <div class="feature-card">
                                <h4>üîë Authentication</h4>
                                <ul>
                                    <li><strong>JWT Tokens:</strong> Stateless authentication</li>
                                    <li><strong>HTTP-only Cookies:</strong> XSS protection</li>
                                    <li><strong>Token Expiration:</strong> 7-day refresh cycle</li>
                                    <li><strong>Secure Headers:</strong> Helmet.js protection</li>
                                </ul>
                            </div>
                            
                            <div class="feature-card">
                                <h4>üõ°Ô∏è Authorization</h4>
                                <ul>
                                    <li><strong>Role-based Access:</strong> User permissions</li>
                                    <li><strong>Resource Isolation:</strong> User data separation</li>
                                    <li><strong>API Rate Limiting:</strong> Abuse prevention</li>
                                    <li><strong>Input Validation:</strong> Mongoose schemas</li>
                                </ul>
                            </div>
                            
                            <div class="feature-card">
                                <h4>üîí Data Protection</h4>
                                <ul>
                                    <li><strong>Encryption:</strong> HTTPS/TLS for all communications</li>
                                    <li><strong>API Keys:</strong> Secure storage in environment variables</li>
                                    <li><strong>Database Security:</strong> Connection encryption</li>
                                    <li><strong>Audit Logging:</strong> Security event tracking</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <h3>üìà Scalability Architecture</h3>
                    <div class="api-endpoint">
                        <h4>Horizontal Scaling Strategy</h4>
                        <div class="diagram-container">
                            <div class="mermaid">
                                graph TB
                                    subgraph "Load Balancer"
                                        A[Nginx/HAProxy]
                                    end
                                    
                                    subgraph "Application Servers"
                                        B[Node.js Instance 1]
                                        C[Node.js Instance 2]
                                        D[Node.js Instance N]
                                    end
                                    
                                    subgraph "Database Cluster"
                                        E[MongoDB Primary]
                                        F[MongoDB Secondary 1]
                                        G[MongoDB Secondary 2]
                                    end
                                    
                                    subgraph "Cache Cluster"
                                        H[Redis Master]
                                        I[Redis Slave 1]
                                        J[Redis Slave 2]
                                    end
                                    
                                    A --> B
                                    A --> C
                                    A --> D
                                    B --> E
                                    C --> E
                                    D --> E
                                    E --> F
                                    E --> G
                                    B --> H
                                    C --> H
                                    D --> H
                                    H --> I
                                    H --> J
                                    
                                    style A fill:#ff6b6b,stroke:#333,stroke-width:2px,color:#fff
                                    style B fill:#4ecdc4,stroke:#333,stroke-width:2px,color:#fff
                                    style C fill:#4ecdc4,stroke:#333,stroke-width:2px,color:#fff
                                    style D fill:#4ecdc4,stroke:#333,stroke-width:2px,color:#fff
                                    style E fill:#45b7d1,stroke:#333,stroke-width:2px,color:#fff
                                    style H fill:#f9ca24,stroke:#333,stroke-width:2px,color:#fff
                            </div>
                        </div>
                    </div>

                    <div class="schema-box">
                        <h4>Performance Optimization</h4>
                        <ul class="step-list">
                            <li><strong>Database Indexing:</strong> Optimized MongoDB indexes for query performance</li>
                            <li><strong>Redis Caching:</strong> Frequently accessed data cached in memory</li>
                            <li><strong>Connection Pooling:</strong> Efficient database connection management</li>
                            <li><strong>CDN Integration:</strong> Static asset delivery optimization</li>
                            <li><strong>Compression:</strong> Gzip compression for API responses</li>
                            <li><strong>Rate Limiting:</strong> API rate limiting to prevent abuse</li>
                        </ul>
                    </div>

                    <div class="highlight-box">
                        <h4>üéØ Architecture Benefits</h4>
                        <ul>
                            <li><strong>Modularity:</strong> Clear separation of concerns enables easy maintenance</li>
                            <li><strong>Scalability:</strong> Horizontal scaling capability for high traffic</li>
                            <li><strong>Reliability:</strong> Fault-tolerant design with error handling</li>
                            <li><strong>Performance:</strong> Optimized for real-time data processing</li>
                            <li><strong>Security:</strong> Multi-layered security approach</li>
                            <li><strong>Maintainability:</strong> Clean code structure and documentation</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid diagrams
        mermaid.initialize({ startOnLoad: true });
        
        // Add active class to current page in navigation
        document.addEventListener('DOMContentLoaded', function() {
            const currentPage = window.location.pathname.split('/').pop() || 'index.html';
            const navLinks = document.querySelectorAll('.toc-main');
            
            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
